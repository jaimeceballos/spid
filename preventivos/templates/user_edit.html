
<div class="row">
  <div class="col-md-12">
    <div class="alert alert-dismissable" role="alert" style="display:none" id="mensajes">

    </div>
  </div>
</div>
<div class="" id="formulario" >
    <div class="row-fluid">
      <div class="col-md-8 form-group form-group-lg">
            <div class="input-group">
              <span class="input-group-addon">Buscar</span>
              <input type="text" id="buscar" class="form-control" value="" placeholder="Nombre, Apellido o Documento">
              <span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>
              <div id="error" style="display:none">
                <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"></span>
                <span id="inputError" class="sr-only">(error)</span>
              </div>
            </div>
            <input type="hidden" id="id_usuario" value="">
        </div>

    </div>

    <div class="row-fluid" id="detalle" style="display:none">
      <div class="row">
        <div class="col-md-4">
          <p id="nombre">

          </p>
        </div>
      </div>
      <div class="row">
        <div class="col-md-2 ">

          <p id="usuario">

          </p>
        </div>
        <div class="col-md-4 ">

          <p id="email">

          </p>
        </div>
      </div>
      <div class="row" id="divBtnDestino">
        <div class="col-md-2">
          <button type="button"  class="btn btn-xs btn-primary" id="btnDestino">Destino/Funcion</button>
        </div>
        <div class="col-md-2" id="divBtnReenvio">
          <button type="button"  class="btn btn-xs btn-success" id="btnReenvio">Reenvio usuario</button>
        </div>
        <div class="col-md-2" id="divBtnMail">
          <button type="button"  class="btn btn-xs btn-warning" id="btnMail">Moficar mail</button>
        </div>
        <div class="col-md-2" id="divBtnActivar">
          <button type="button"  class="btn btn-xs btn-danger" id="btnActivar">Activar</button>
        </div>
      </div>

    </div>
    <div id="success" style="display:none">
      
    </div>
</div>



<script type="text/javascript">

  $("#btnDestino").click(function(event){
    var usuario = $("#id_usuario").val();
    var url = "/preventivos/user/edit/destino/"+usuario+"/";
    $.get(url,function(data){

    })
    .done(function(data){
      $("#success").empty().append(data).show("slow");
    })
  });
  $("#id_grupos").change(function(){

    var arr = $(this).val();
    if(jQuery.inArray('2',arr) >= 0 || jQuery.inArray('7',arr) >= 0 ){
      $("#funcion").show("slow");
    }else{
      $("#funcion").hide("slow");
    }
  });

  function buscar(usuario){

      var url = '/preventivos/buscar_usuario/'+usuario+'/';
      $.get(url,function(data){

      })
      .done(function(data){
        var activo = data[0]["fields"]["is_active"];
        $("#usuario").empty().append("<strong>Nombre y apellido: </strong> "+data[0]["fields"]["username"]);
        $("#email").empty().append("<strong ><i class='glyphicon glyphicon-user'></i> Usuario:</strong>"+data[0]["fields"]["email"]);
        $("#nombre").empty().append("<strong><i class='glyphicon glyphicon-envelope'></i> Email:</strong>"+data[0]["fields"]["last_name"]+', '+data[0]["fields"]["first_name"]);
        if(!activo){
          $("#divBtnActivar").show();
        }else{
          $("#divBtnActivar").hide();
        }
        $("#detalle").show("slow");
      });

  }

  $("#buscar").autocomplete({
    source: "/preventivos/usuarios_ajax/",
    minLength: 2,
    select:function (event,ui) {
      $("#id_usuario").val(ui.item.id);
      buscar($("#id_usuario").val());

    }
  });


  $("#id_lugar_trabajo").autocomplete({
    source: "/preventivos/dependencias_ajax/",
    minLength: 2,
    select:function (event,ui) {
      $("#id_lugar_trabajo_id").val(ui.item.id);

    }
  });
  $("#id_jerarquia").autocomplete({
    source: "/preventivos/jerarquias_ajax/",
    minLength: 2,
    select:function (event,ui) {
      $("#id_jerarquia_id").val(ui.item.id);

    }
  });




</script>
